<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ترکیب کننده کانفیگ</title>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }
        textarea {
            padding: 10px;
            width: 80%;
            height: 150px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background-color: #1e1e1e;
            color: #ffffff;
        }
        button {
            padding: 10px 20px;
            background-color: #6200ea;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3700b3;
        }
        pre {
            text-align: left;
            background-color: #1e1e1e;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>ترکیب کننده کانفیگ</h1>

    <h2>کانفیگ اصلی:</h2>
    <textarea id="mainConfig" placeholder="کانفیگ اصلی را وارد کنید..."></textarea>

    <h2>کانفیگ ویلس:</h2>
    <textarea id="vlessConfig" placeholder="کانفیگ ویلس را وارد کنید..."></textarea>

    <button onclick="combineConfigs()">ترکیب کانفیگ‌ها</button>

    <h2>کانفیگ ترکیبی:</h2>
    <pre id="combinedConfig"></pre>

    <script>
        function combineConfigs() {
            try {
                const mainConfig = JSON.parse(document.getElementById("mainConfig").value);
                const vlessConfig = parseVlessConfig(document.getElementById("vlessConfig").value);

                // ترکیب کانفیگ‌ها
                const combinedConfig = {
                    ...mainConfig,
                    "outbounds": [
                        ...mainConfig.outbounds,
                        vlessConfig
                    ]
                };

                document.getElementById("combinedConfig").textContent = JSON.stringify(combinedConfig, null, 2);
            } catch (error) {
                alert("خطا در تجزیه کانفیگ: " + error.message);
            }
        }

        function parseVlessConfig(vlessString) {
            const regex = /vless:\/\/([^@]+)@([^:]+):(\d+)\/\?([^#]+)#(.*)/;
            const match = vlessString.match(regex);
            if (!match) {
                throw new Error("کانفیگ ویلس معتبر نیست.");
            }

            const id = match[1];
            const address = match[2];
            const port = match[3];
            const params = new URLSearchParams(match[4]);

            return {
                "protocol": "vless",
                "settings": {
                    "vnext": [
                        {
                            "address": address,
                            "port": parseInt(port),
                            "users": [
                                {
                                    "id": id,
                                    "encryption": "none",
                                    "level": 8
                                }
                            ]
                        }
                    ]
                },
                "streamSettings": {
                    "network": params.get("type") || "tcp",
                    "security": params.get("security") || "none",
                    "sockopt": {
                        "dialerProxy": params.get("dialerProxy") || "none",
                        "tcpNoDelay": true
                    }
                },
                "tag": "proxy"
            };
        }
    </script>

</body>
</html>
